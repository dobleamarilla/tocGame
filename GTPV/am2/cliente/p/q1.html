<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html nomanifest="gtpv.appcache" xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>GTPV</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<base href="cliente/"/>
<link type="text/css" href="css/ui-lightness/jquery-ui-1.8.13.custom.css" rel="stylesheet" />
<link type="text/css" href="css/gtpv/gtpv.css" rel="stylesheet" />
<script src="jquery/jquery-1.7.1.mod.js"></script>
<!--<script src="jquery/jquery-ui-1.8.13.custom.js"></script>--> 
<script>
H = {};
H.DB = function() {
	var my = {};
	
	var prefijo = "";
	var principalSufix = "Principal";

	my.open = function(dbName) { return openDatabase(dbName, "", "", 5000); }

	my.exec = function(tx, sqlStatement, args, callback, errorCallback) {
		tx.executeSql(sqlStatement, args, callback, function (t,e) {
			console.log(e.message+" code:"+e.code+"\n"+sqlStatement+"\n"+args.toString());
			alert(e.message+" code:"+e.code+"\n"+sqlStatement+"\n"+args.toString());
			
			if (typeof errorCallback === "function") return errorCallback(t,e);
			else return true; // anular transaccion, simular no errorCallback en executeSql, return null no funciona
		});
	}
	
	my.transactionWithErr = function(db, transactionCallback, successCallback, errorCallback) {
		 function errorQuota(e) {
			if (e.code !== e.QUOTA_ERR) {
				if (typeof errorCallback === "function") errorCallback(e);
				return;
			}

			var alertErrorDB = newAlertDialog().header(M("Error")).text(M("Error en base de datos")+": "+M("Quota DB"));
			alertErrorDB.appendTo("body").show();		
		}
		db.transaction(transactionCallback, errorQuota, successCallback);
	}
	return my;
	
}();

$(function() {
		alert("01");
	var db = H.DB.open("qq");
	H.DB.transactionWithErr(db, function(tx) {
		H.DB.exec(tx, "CREATE TABLE IF NOT EXISTS [a] ([name] text primary key, [value] text)", []);
		H.DB.exec(tx, "INSERT OR REPLACE INTO [a] (name, value) VALUES (?, ?)", ["www", "eee"]); 
	}, function() { alert("ok"); }, function(e) { alert("ee"); alert(e.message); });
	var db = H.DB.open("ww");
	H.DB.transactionWithErr(db, function(tx) {
		H.DB.exec(tx, "CREATE TABLE IF NOT EXISTS [a] ([name] text primary key, [value] text)", []);
		H.DB.exec(tx, "INSERT OR REPLACE INTO [a] (name, value) VALUES (?, ?)", ["www", "eee"]); 
	}, function() { alert("ok"); }, function(e) { alert("ee"); alert(e.message); });
	
			alert("02");

	function g() {
		alert("q11");
		var db = H.DB.open("qq");
		H.DB.transactionWithErr(db, function(tx) {
			H.DB.exec(tx, "INSERT OR REPLACE INTO [a] (name, value) VALUES (?, ?)", ["www", "eee"]); 
		}, function() { alert("ok"); },  function(e) { alert("ee2"); alert(e.message); });
		alert("q12");
		setTimeout(g,2000);
	}
	function w() {
		alert("w11");
		var db = H.DB.open("ww");
		H.DB.transactionWithErr(db, function(tx) {
			H.DB.exec(tx, "INSERT OR REPLACE INTO [a] (name, value) VALUES (?, ?)", ["www", "eee"]); 
		}, function() { alert("ok"); },  function(e) { alert("ee2"); alert(e.message); });
		alert("w12");
		setTimeout(w,2000);
	}
	setTimeout(g,2000);
	setTimeout(w,3000);
	
});

</script>
</head>

<body>
</body>
</html>
